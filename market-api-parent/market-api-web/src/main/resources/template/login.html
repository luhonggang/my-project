<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/x-icon" href="../favicon.ico">
    <link rel="stylesheet" href="market/css/login.css">
    <title>欢迎登录人气通，国内最顶尖的人气提升平台</title>
    <script type="text/javascript">
        /* 窗口尺寸改变的事件 */
        onload = function(){
            changeBgSize();
        }

        onresize = function(){
            changeBgSize();
        }
        function changeBgSize(){
            /* 得到窗口的宽高 */
            var w = document.body.clientWidth;
            var h = document.body.parentElement.clientHeight;
            /* 把得到的窗口宽高给到body的背景图片 */
            document.body.style.backgroundSize = w+"px "+h+"px";
        }

        /*手机号失去焦点事件验证 这里 你要有时间就优化一下吧，这个显示隐藏不怎么美观，我就直接弹框了*/
        function checkPhone(){
            $("#phone_yz").hide();
            var phone = document.getElementById('forget_phone').value;
            if(!(/^1[3456978]\d{9}$/.test(phone))){
                $("#phone_yz").show();
                alert('输入的手机号码有误');
                return;
            }

        }
        /** 检查密码 包含字母大小写数字下划线 **/
        function checkPwd(){
            $("#pwd_yz").hide();
            var pwd = $('#pwd').val();
            var reg=/^[a-zA-Z0-9_]{4,10}$/;
            if(!(reg.test(pwd))){
                $("#pwd_yz").show();
                return;
            }
            var confirmPwd = $('#conform_pwd').val();
            if(pwd != confirmPwd){
                alert('确认密码输入有误,请重新输入确认密码！');
                return;
            }
        }
        function checkWjPwd() {
            $("#wjpwd").show();
            $("#phone").val('');
            $('#pwd').val('');
            $('#conform_pwd').val('');
        }
    </script>
    <style type="text/css">
        body{
            margin: 0;
            background-image: url("market/images/login/ld-bg.jpg");
            background-repeat: no-repeat;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <div class="header">
        <!--导航条-->
        <span style="padding-left: 15%">欢迎登陆人气通&nbsp;|</span>
        <span><a href="#">返回首页</a></span>
        <span style="padding-left: 40%;"><a href="register.html">用户注册&nbsp;|</a></span>
        <span><a href="#">帮助中心&nbsp;|</a></span>
        <span><a href="#">联系客服</a></span>

        <!--logo-->
        <div class="div_boss">
        <div class="logo_img">
            <img src="market/images/login/ld-bg1.png">
            <div class="login_text1">
                网店提升专家<br/>
               <span> RENQITONG</span>
            </div>
            <div class="login_hr" style="border:1.5px solid #F7494A;width:200px;"></div>
            <div class="login_text2">
                网店排名提升，就用人气通
            </div>
        </div>

        <!--登陆-->
        <!--<form id="loginForm">-->
        <div class="login_div">
            <div class="login_div1">
                <span>用户登陆</span>
                <a href="register.html">没有账号？立即注册</a>
            </div>

            <div class="phone">
                <input id ="phone" type="text" name="phone" placeholder="请输入您的手机号码"/>
                <div class="phone_div">
                    <img src="market/images/login/user-c1.png">
                </div>

            </div>
            <div class="pwd">
                <input id="customer_pwd" type="password" name="passWord" placeholder="请输入您的用户密码"/>
                <div class="pwd_div">
                    <img src="market/images/login/password-c1.png">
                </div>
            </div>
            <div class="login_btn">
                <input type="submit" id="login_submit" value="登&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;陆"/>
            </div>
            <div class="mm_pwd">
                <input style="cursor:pointer;" type="checkbox" id="jz"/><label for="jz">记住密码</label>
                <a style="cursor:pointer;" onclick="checkWjPwd()">忘记密码？</a>
            </div>
            <div class="reg_foot">
                <a href="register.html">立即注册，快来提升你网店的各项指标吧</a>
            </div>
        </div>
        <!--</form>-->
    </div>
    <!--尾部-->
    <div class="footer">
        <span>2,236,0家网店都在用人气通推广提升店铺人气，还可以免费挂机赚钱，你还在等什么？</span>
    </div>
        <hr/>
    <div id="wjpwd" class="wjmm" style="display: none;">
        <p id="close_window" style="cursor:pointer;font-size: 20px;color: red;margin-top: -15px;font-family: 楷体">请输入需要重置登录密码账户&nbsp;&nbsp;X</p>
        <!--<button><img style="width:25px;height:25px;padding: -15px -15px -15px -15px;" src="login_imgs/x.jpg"></button>-->
        <input style="margin-top: -10px;" type="text" onblur="checkPhone()" id="forget_phone" placeholder="请输入你的手机号码"/>
        <input type="text" id="pwd" placeholder="请输入您的新密码"/><!--<button style="margin-top: 15px;">获取手机验证码</button>-->
        <span style="color: red;margin: 5px 0 0 0;display: none;" id="pwd_yz">您输入的密码格式有误</span>
        <input id="conform_pwd" type="password" onblur="checkPwd()" placeholder="确认您的新密码"/><br/>
        <button style="margin-top: 15px;" id="commit" class="wjmm_final" type="button">完&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;成</button>
    </div>
  </div>
</body>
<script src="/market/js/base.js" type="text/javascript"></script>
<script src="/market/js/jquery-3.1.1.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function(){
        // 自动控制显示隐藏
        // $('.header').click(function (e) {
        //     // 获取点击发生的对象
        //     alert(e.target);
        //     var target = $(e.target);
        //     if(!target.is('#wjpwd')){
        //         if($('#wjpwd').is(':visible')){
        //             $('#wjpwd').hide();
        //         }else{
        //             $('#wjpwd').show();
        //         }
        //     }
        // });

        // 关闭修改密码框
        $('#close_window').on('click',function () {
            $('#wjpwd').hide();
            $("#phone").val('');
            $('#pwd').val('');
            $('#conform_pwd').val('');
        });
        // 修改密码 点击完成按钮
        $('#commit').on('click',function () {
            var phone = $('#forget_phone').val();
            var pwd = $('#pwd').val();
            var confirmPwd = $('#conform_pwd').val();
            if(phone == '' || pwd == '' || confirmPwd == ''){
                alert('参数为空'); // 后续优化
                return;
            }
            if(pwd != confirmPwd){
                alert('输入的密码,请重新确认密码！');
                return;
            }
            var jsonPwd = '{"phone":"'+phone+'","passWord":"'+pwd+'","confirmPwd":"'+confirmPwd+'"}';
            $.ajax({
                url:baseUrl+'customer/updatePwd',
                type:'POST',
                async:"true", //默认是true,异步
                dataType:"json",
                data:jsonPwd,
                processData:false, //post一个对象需要设置为false
                contentType:"application/json",
                success:function(result){
                    console.log(result);
                    if(result.code=="200"){
                        $('#wjpwd').hide();
                    }else if(result.code=="418"){
                        alert(result.msg);
                        // $("#pwd_yz").fadeIn(3000);
                    }else if(result.code == "500"){
                        alert(result.msg);
                    }
                }
            });
        });

        // 回车键登录
        document.onkeyup = function (event) {
            var e = event || window.event;
            var keyCode = e.keyCode || e.which;
            if(keyCode === 13){
                $("#login_submit").click();
            }
        };


        // $('#customer_pwd').on('keypress',function(event){
        //     if(event.keyCode == 13)
        //     {
        //         AjaxLogin();
        //     }
        // });

        $("#login_submit").click(function () {
            var customerPhone = $("#phone").val();
            if(customerPhone == ''){
                alert("请输入登录手机号");
               return;
            }
            if(customerPwd == ''){
                alert("请输入登录密码");
                return;
            }
            var customerPwd = $("#customer_pwd").val();
            var jsonFrom = '{"phone":"'+customerPhone+'","passWord":"'+customerPwd+'"}';
            console.log("数据格式 ： "+jsonFrom);
            $.ajax({
                url:baseUrl+'customer/login',
                type:'POST',
                async:"true", //默认是true,异步
                dataType:"json",
                data:jsonFrom,
                processData:false, //post一个对象需要设置为false
                contentType:"application/json",
                success:function(result){
                    console.log(result);
                    if(result.code=="200"){
                        $('#forget_phone').val(result.phone);
                        // 登录成功后 将用户的token 存储到localStorage,用户退出的时候 清空值
//                    用户点击退出的时候 跳转到登录页面 清空
//                    $this.localstorage.clear();
                        var localCache = window.localStorage;
                        localCache.setItem('TOKEN',result.data.token);
                        localCache.setItem('customerId',result.data.customerId);
                        localCache.setItem('phone',result.data.phone);
                        localCache.setItem('domainName',baseUrl);
                        window.location.href = baseUrl+"page/customerInfo.html";
                    }else if(result.code=="201"){
                        alert(result.msg);
                        // $("#tick").text(data.message).css("color", "red");
                    }else if(result.code == '400'){
                        // 手机号格式异常
                        alert(result.msg);
                    }else if(result.code == '416'){
                        alert('输入的密码不正确');
                    }
                }
            });
        });
    });
</script>
</html>

















